# Linux命令之Top

![image-20210527113329108](C:\Users\clown\AppData\Roaming\Typora\typora-user-images\image-20210527113329108.png)

### 第一行，任务队列信息，同uptime命令的执行结果

系统时间：11:32:32

运行时间：up 61 days, 23:26

当前登录用户：1 user

负载均衡（uptime）：load average:  1.35, 1.25, 1.29

​                                  average后面的三个数分别是1分钟、5分钟、15分钟的负载情况。

（load average数据是每隔5秒检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5，就表明系统在超负荷运转）

### 第二行，Tasks - 任务（进程）

总进程：231total，运行：2 running，休眠：229 sleeping，停止：0 stopped，僵尸进程：0 zombie

### 第三行，cpu状态信息

15.2%us【user space】--- 用户空间占用CPU的百分比。

4.9%sy 【sysctl】--- 内核空间占用CPU的百分比。

0.0%ni  --- 改变过优先级的进程占用CPU的百分比。

79.8%id 【idolt】 --- 空闲CPU百分比。

0.0%wa 【wait】 --- IO等待占用CPU的百分比。

0.0%hi 【Hardware IRQ】--- 硬中断占用CPU的百分比。

0.2%si 【Software Interrupts】--- 软中断占用CPU的百分比。

0.0%st 【】

### 第四行，内存状态 Mem

8060540k total  总内存大小, 6989544k used 已使用内存大小, 1070996k free 空闲内存大小, 1143720k buffers 【缓存的内存量】

### 第五行，swap交换分区信息

8208380k total 总内存大小, 942352k used 已使用内存大小,  7266028k free 空闲内存大小, 3101300k cached 【缓冲的交换区总量】

补充说明：可用内存 =  free + buffer + cached

在对内存监控中，时刻注意swap 交换区的 used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，表明真正的内存不够用了。

### 第六行，空行

### 第七行以下：各进程（任务）的状态监控

PID ---- 进程id

USER --- 进程所有者。

PR --- 进程优先级。

NI --- nice值，负值表示高优先级，正值表示低优先级。

VIRT --- 进程使用的虚拟内存总量，单位kb。VIRT = SWAP + RES。

RES --- 进程使用的、未被换出的物理内存大小，单位kb。RES = CODE + DATA。

SHR --- 共享内存大小，单位kb。

S --- 进程状态。D代表不可中断的睡眠状态；R代表运行；S代表睡眠；T代表跟踪/停止；Z代表僵尸进程。

%CPU --- 上次更新到现在CPU时间占用百分比。

%MEM --- 进程使用的物理内存百分比。

TIME+ --- 进程使用的CPU时间总计，单位1/100 秒。

COMMAND --- 进程名称（命令名/命令行）。

--------------------------------------------------------------以下信息默认没展示---------------------------------------------------------------------

DATA  ---  可执行代码以外的部分（数据段+栈）占用的物理内存大小，单位kb。【简单理解，数据占用的内存，真正的该程序要求的数据空间，是真正在运行中要使用的】。

CODE --- 可执行代码占用的物理内存大小，单位kb。

可以通过指令f进入 编排基本视图，这里列出了所有可在top基本视图中显示的进程字段，有带 " * " 的并且标注为大写字母的字段是可显示的，没有带 " * " 并且是小写字母的字段是不显示的。如果要在基本视图中显示CODE和DATA两个字段，可以移动上下键到这两个字段，然后按d键选择这两个字段，然后按q退出就可以。【提示：按f进入编排基本视图后，如果想进行进程字段显示顺序做修改，使用上下键移动到该字段，然后按右键（即选中该字段），然后上下键移动到需要的位置即可】

![image-20210527204228170](C:\Users\clown\AppData\Roaming\Typora\typora-user-images\image-20210527204228170.png)

--------------------------------------------------------------------------------------------------------------------------------------------------------------

### VIRT :  virtual memory usage 虚拟内存

1、进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等

注意：假如进程申请100m的内存，但实际只使用了10m,那么它会申请100m，而不是实际的使用量10m.

### RES  :  resident memory usage 常驻内存（单位kb）

1、进程当前使用的内存大小，但不包括swap out

2、包含其他进程的共享

3、如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反

补充说明：**当某进程向OS请求内存发现不足时，OS会把内存中暂时不用的数据交换出去，放在SWAP分区中，这个过程称为SWAP OUT**

### SHR : shared memory 共享内存

1、除了自身进程的共享内存，也包括其他进行的共享内存

2、虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小

3、计算某个进程所占物理内存大小公式：RES - SHR

4、swap out后，它将会降下来

### top运行中可以通过内部命令对进程的显示方式进行控制：内部命令如下

```
s ：改变画面更新频率。

l ：关闭或开启第一行top信息。

t ：关闭或开启第二行Tasks和第三行Cpus信息（需要连按3次才可以关闭）。

m ：关闭或开启第四行Mem和第五行Swap信息（需要连按3次才可以关闭）。

N ：以PID的大小进行降序排序。

P：以CPU占用率大小进行降序排序。

M：以内存占用率大小进行降序排序。

h：显示帮助

n：设置在进程列表所显示进程的数量

q：退出top
```



### top命令的使用方法

```
使用格式：top [-] [p] [S] [s] [i] [c]

参数说明：

p：通过指定监控进程ID来显示某个进程的状态。top -p 进程ID

S：指定累计模式。

s：使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。

i：使top不显示任何闲置或者僵尸进程。

c：显示整个命令行而不只是显示命令名称。
```



### **Linux查看物理CPU个数、核数、逻辑CPU个数**

```
# 总核数 = 物理CPU个数 X 每颗物理CPU的核数 
# 总逻辑CPU数 = 物理CPU个数 X 每颗物理CPU的核数 X 超线程数

# 查看物理CPU个数
cat /proc/cpuinfo| grep "physical id"| sort| uniq| wc -l

# 查看每个物理CPU中core的个数(即核数)
cat /proc/cpuinfo| grep "cpu cores"| uniq

# 查看逻辑CPU的个数
cat /proc/cpuinfo| grep "processor"| wc -l
# 查看CPU信息（型号）
cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c
```

